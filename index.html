<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=no">
    <title>–û—Ä—Ñ–æ-–≥–∞–ª–∞–∫—Ç–∏–∫–∞ ¬∑ –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
            user-select: none;
        }

        body {
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 12px;
        }

        .game {
            max-width: 1000px;
            width: 100%;
            background: #03050f;
            border-radius: 48px;
            border: 1px solid rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 60px rgba(0, 200, 255, 0.4);
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        /* –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .space-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            animation: spacePulse 8s ease-in-out infinite;
        }

        @keyframes spacePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* –ü–ª–∞–Ω–µ—Ç—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .planet {
            position: absolute;
            border-radius: 50%;
            opacity: 0.25;
            box-shadow: 0 0 60px rgba(255, 200, 100, 0.3);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) translateX(0px); }
            25% { transform: translateY(-15px) translateX(10px); }
            50% { transform: translateY(5px) translateX(-10px); }
            75% { transform: translateY(15px) translateX(5px); }
        }

        .planet1 { 
            width: 180px; 
            height: 180px; 
            top: 5%; 
            left: -40px; 
            background: radial-gradient(circle at 30% 30%, #6b8cff, #2a3f7a);
            animation: float 25s ease-in-out infinite, rotateSlow 60s linear infinite;
        }
        .planet2 { 
            width: 220px; 
            height: 220px; 
            bottom: -60px; 
            right: -50px; 
            background: radial-gradient(circle at 40% 40%, #ff9a9a, #7a2a2a);
            animation: float 30s ease-in-out infinite reverse, rotateSlow 80s linear infinite;
        }
        .planet3 { 
            width: 130px; 
            height: 130px; 
            top: 50%; 
            right: 15%; 
            background: radial-gradient(circle at 30% 30%, #7aff7a, #2a7a2a);
            animation: float 22s ease-in-out infinite, rotateSlow 70s linear infinite;
        }

        @keyframes rotateSlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* –ê—Å—Ç–µ—Ä–æ–∏–¥–Ω—ã–π –ø–æ—è—Å (–ª–µ—Ç–∞—é—â–∏–µ –∫–∞–º–Ω–∏) */
        .asteroid-belt {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .mini-asteroid {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(100, 150, 200, 0.2);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            box-shadow: 0 0 15px rgba(0, 200, 255, 0.3);
            animation: drift 40s linear infinite;
        }

        @keyframes drift {
            from { transform: translateX(-100px) translateY(-100px) rotate(0deg); }
            to { transform: translateX(120%) translateY(120%) rotate(720deg); }
        }

        /* –ó–≤—ë–∑–¥—ã —Å –º–µ—Ä—Ü–∞–Ω–∏–µ–º */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px white;
            animation: moveStar 12s linear infinite, twinkle 3s ease-in-out infinite;
        }

        @keyframes moveStar {
            from { transform: translateY(-10px) translateX(-10px); opacity: 0.8; }
            to { transform: translateY(110%) translateX(20px); opacity: 0; }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏ (CSS –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã) */
        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(100, 50, 200, 0.1), transparent 70%);
            filter: blur(40px);
            animation: nebulaFloat 30s ease-in-out infinite;
            pointer-events: none;
        }

        .nebula2 {
            background: radial-gradient(circle at 50% 50%, rgba(50, 200, 150, 0.1), transparent 70%);
            width: 400px;
            height: 400px;
            top: 20%;
            right: 10%;
            animation: nebulaFloat 40s ease-in-out infinite reverse;
        }

        .nebula3 {
            background: radial-gradient(circle at 50% 50%, rgba(200, 100, 50, 0.1), transparent 70%);
            width: 350px;
            height: 350px;
            bottom: 10%;
            left: 5%;
            animation: nebulaFloat 35s ease-in-out infinite;
        }

        @keyframes nebulaFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(20px, -20px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0 10px;
            position: relative;
            z-index: 10;
        }

        .lives {
            display: flex;
            gap: 10px;
        }

        .life {
            width: 35px;
            height: 35px;
            background: #0ff;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            box-shadow: 0 0 20px #0ff;
            transition: 0.2s;
            animation: lifePulse 2s ease-in-out infinite;
        }

        @keyframes lifePulse {
            0%, 100% { box-shadow: 0 0 20px #0ff; }
            50% { box-shadow: 0 0 35px #0ff, 0 0 10px #fff; }
        }

        .life.dim { 
            opacity: 0.2; 
            background: #3a5a6a; 
            box-shadow: none;
            animation: none;
        }

        .stats-right {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .learned-counter {
            font-size: 28px;
            font-weight: 900;
            color: #b8ffff;
            text-shadow: 0 0 15px cyan, 0 0 30px #00ffff;
            background: rgba(0, 255, 255, 0.1);
            padding: 8px 20px;
            border-radius: 40px;
            border: 1px solid cyan;
            backdrop-filter: blur(5px);
            animation: glowPulse 3s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 20px cyan; }
            50% { box-shadow: 0 0 40px cyan, 0 0 20px #fff; }
        }

        .score {
            font-size: 32px;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 15px #ffaa00, 0 0 30px #ff5500;
            animation: scoreGlow 2s ease-in-out infinite;
        }

        @keyframes scoreGlow {
            0%, 100% { text-shadow: 0 0 15px #ffaa00; }
            50% { text-shadow: 0 0 30px #ffaa00, 0 0 20px #ff5500; }
        }

        .pause-btn {
            background: rgba(0,255,255,0.1);
            border: 2px solid cyan;
            color: cyan;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 34px;
            cursor: pointer;
            box-shadow: 0 0 20px cyan;
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }

        .pause-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px cyan;
        }

        /* Canvas ‚Äî –∫–æ–º–µ—Ç–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .canvas-wrap {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1.1;
            background: rgba(0,0,0,0.4);
            border-radius: 30px;
            border: 1px solid rgba(0,255,255,0.7);
            box-shadow: inset 0 0 80px rgba(0,200,255,0.2), 0 0 40px rgba(0,255,255,0.3);
            overflow: hidden;
            margin-bottom: 20px;
            z-index: 10;
            backdrop-filter: blur(2px);
            animation: borderPulse 4s ease-in-out infinite;
        }

        @keyframes borderPulse {
            0%, 100% { border-color: rgba(0,255,255,0.7); box-shadow: inset 0 0 80px rgba(0,200,255,0.2), 0 0 40px rgba(0,255,255,0.3); }
            50% { border-color: rgba(0,255,255,1); box-shadow: inset 0 0 100px rgba(0,200,255,0.3), 0 0 60px rgba(0,255,255,0.5); }
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .message {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #ffd966;
            text-shadow: 0 0 20px #ffaa00, 0 0 40px #ff5500, 0 0 60px #ff0000;
            pointer-events: none;
            z-index: 30;
            animation: messagePulse 1.5s ease-in-out infinite;
        }

        @keyframes messagePulse {
            0%, 100% { transform: scale(1); text-shadow: 0 0 20px #ffaa00, 0 0 40px #ff5500; }
            50% { transform: scale(1.05); text-shadow: 0 0 30px #ffaa00, 0 0 60px #ff5500, 0 0 20px #fff; }
        }

        /* –ü—É—à–∫–∏ */
        .cannons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0 10px;
            flex-wrap: wrap;
            position: relative;
            z-index: 20;
        }

        .cannon {
            width: 110px;
            height: 110px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            font-weight: 900;
            color: #0ff;
            text-shadow: 0 0 20px cyan, 0 0 40px #00ffff;
            cursor: pointer;
            transition: 0.07s;
            touch-action: manipulation;
            background-image: url('cannon.png');
            transform: rotate(-45deg);
            animation: cannonFloat 3s ease-in-out infinite;
        }

        @keyframes cannonFloat {
            0%, 100% { transform: rotate(-45deg) translateY(0px); }
            50% { transform: rotate(-45deg) translateY(-5px); }
        }

        .cannon span {
            transform: rotate(45deg);
            display: inline-block;
            animation: letterGlow 2s ease-in-out infinite;
        }

        @keyframes letterGlow {
            0%, 100% { text-shadow: 0 0 20px cyan; }
            50% { text-shadow: 0 0 40px cyan, 0 0 20px white; }
        }

        .cannon.fallback {
            background: linear-gradient(145deg, #1e263f, #0c0f1a);
            border: 3px solid #0ff;
            border-radius: 30px 30px 60% 60%;
            box-shadow: 0 0 30px #0ff, inset 0 0 20px rgba(0,255,255,0.3);
            background-image: none;
            transform: none;
        }

        .cannon.fallback span {
            transform: none;
        }

        .cannon:active {
            transform: rotate(-45deg) scale(0.85);
            filter: brightness(1.5);
        }

        .cannon.fallback:active {
            transform: scale(0.85);
        }

        .cannon.fire {
            filter: brightness(2) drop-shadow(0 0 30px white);
            transform: rotate(-45deg) scale(0.9);
            animation: none;
        }

        /* –°–ª–æ–≤–∞—Ä—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .dictionary {
            background: rgba(8, 12, 25, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 20px;
            border: 1px solid cyan;
            margin-top: 15px;
            position: relative;
            z-index: 15;
            animation: dictionaryGlow 4s ease-in-out infinite;
        }

        @keyframes dictionaryGlow {
            0%, 100% { border-color: cyan; box-shadow: 0 0 20px rgba(0,255,255,0.3); }
            50% { border-color: #00ffff; box-shadow: 0 0 40px rgba(0,255,255,0.5); }
        }

        .progress {
            height: 22px;
            background: #151e2a;
            border-radius: 30px;
            margin-bottom: 18px;
            overflow: hidden;
            border: 1px solid cyan;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #0ff, #c0f, #0ff);
            background-size: 200% 100%;
            box-shadow: 0 0 25px #0ff;
            transition: width 0.2s;
            animation: progressFlow 3s linear infinite;
        }

        @keyframes progressFlow {
            from { background-position: 0% 0; }
            to { background-position: 200% 0; }
        }

        .dict-header {
            display: flex;
            justify-content: space-between;
            color: #bfffff;
            font-size: 24px;
            margin-bottom: 15px;
            text-shadow: 0 0 8px cyan;
            animation: headerPulse 3s ease-in-out infinite;
        }

        @keyframes headerPulse {
            0%, 100% { text-shadow: 0 0 8px cyan; }
            50% { text-shadow: 0 0 20px cyan, 0 0 10px white; }
        }

        .word-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            max-height: 170px;
            overflow-y: auto;
            padding: 8px 0;
        }

        .word-chip {
            background: #0e1a2a;
            border-left: 8px solid #0ff;
            padding: 10px 22px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
            transition: 0.3s;
            animation: chipAppear 0.5s ease-out;
        }

        @keyframes chipAppear {
            from { transform: scale(0) rotate(-10deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }

        .word-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px cyan;
            border-left-color: #ff0;
        }

        .word-chip span {
            background: #005f73;
            padding: 4px 14px;
            border-radius: 40px;
            margin-left: 8px;
            color: #ffd966;
        }

        /* –û–≤–µ—Ä–ª–µ–∏ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(12px);
            border-radius: 48px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            color: white;
            animation: overlayAppear 0.5s ease-out;
        }

        @keyframes overlayAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .hidden { display: none !important; }

        .restart-btn {
            background: transparent;
            border: 4px solid cyan;
            color: cyan;
            font-size: 38px;
            padding: 18px 60px;
            border-radius: 100px;
            margin-top: 35px;
            cursor: pointer;
            box-shadow: 0 0 40px cyan;
            transition: 0.15s;
            font-weight: bold;
            animation: btnPulse 2s ease-in-out infinite;
        }

        @keyframes btnPulse {
            0%, 100% { box-shadow: 0 0 40px cyan; transform: scale(1); }
            50% { box-shadow: 0 0 70px cyan, 0 0 30px white; transform: scale(1.05); }
        }

        .restart-btn:active {
            background: cyan;
            color: black;
            transform: scale(0.95);
        }

        .gameover-title {
            font-size: 60px;
            margin-bottom: 20px;
            text-shadow: 0 0 30px red, 0 0 60px #ff0000;
            color: #ff8888;
            animation: gameoverPulse 1.5s ease-in-out infinite;
        }

        @keyframes gameoverPulse {
            0%, 100% { text-shadow: 0 0 30px red; }
            50% { text-shadow: 0 0 60px red, 0 0 30px #ff5500; }
        }

        @media (max-width: 700px) {
            .cannon { width: 80px; height: 80px; font-size: 40px; }
            .learned-counter { font-size: 22px; padding: 5px 15px; }
            .score { font-size: 26px; }
        }
    </style>
</head>
<body>
    <div class="game" id="game">
        <!-- –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ -->
        <div class="space-bg" id="spaceBg">
            <!-- –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏ -->
            <div class="nebula" style="top: 10%; left: 20%;"></div>
            <div class="nebula nebula2" style="top: 60%; left: 70%;"></div>
            <div class="nebula nebula3" style="top: 30%; left: 50%;"></div>
            
            <!-- –ü–ª–∞–Ω–µ—Ç—ã -->
            <div class="planet planet1"></div>
            <div class="planet planet2"></div>
            <div class="planet planet3"></div>
            
            <!-- –ê—Å—Ç–µ—Ä–æ–∏–¥–Ω—ã–π –ø–æ—è—Å -->
            <div class="asteroid-belt" id="asteroidBelt"></div>
        </div>

        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="top">
            <div class="lives" id="livesContainer"></div>
            <div class="stats-right">
                <div class="learned-counter" id="learnedCounter">0/34</div>
                <div class="score" id="scoreDisplay">0</div>
                <div class="pause-btn" id="pauseBtn">‚è∏</div>
            </div>
        </div>

        <!-- Canvas —Å –∫–æ–º–µ—Ç–æ–π -->
        <div class="canvas-wrap">
            <canvas id="gameCanvas" width="1000" height="1100"></canvas>
            <div class="message" id="messageEl">‚ö° –°–¢–ê–†–¢ ‚ö°</div>
        </div>

        <!-- –ü—É—à–∫–∏ —Å –±—É–∫–≤–∞–º–∏ -->
        <div class="cannons" id="cannonPanel">
            <div class="cannon" data-letter="–ê"><span>–ê</span></div>
            <div class="cannon" data-letter="–û"><span>–û</span></div>
            <div class="cannon" data-letter="–ï"><span>–ï</span></div>
            <div class="cannon" data-letter="–ò"><span>–ò</span></div>
            <div class="cannon" data-letter="–Ø"><span>–Ø</span></div>
            <div class="cannon" data-letter="–´"><span>–´</span></div>
            <div class="cannon" data-letter="–Æ"><span>–Æ</span></div>
            <div class="cannon" data-letter="–≠"><span>–≠</span></div>
        </div>

        <!-- –°–ª–æ–≤–∞—Ä—å -->
        <div class="dictionary">
            <div class="progress">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="dict-header">
                <span>üì° –ì–ê–õ–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ê–†–•–ò–í</span>
                <span id="learnedCountDetail">0 / 34</span>
            </div>
            <div class="word-grid" id="wordGrid"></div>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –ø–∞—É–∑—ã -->
        <div id="pauseOverlay" class="overlay hidden">
            <div style="font-size: 80px; margin-bottom: 20px; animation: pulse 2s infinite;">‚è∏</div>
            <div style="font-size: 48px; margin-bottom: 30px; text-shadow: 0 0 30px cyan;">–ì–ò–ü–ï–†–°–û–ù</div>
            <div class="restart-btn" id="resumeBtn">–ü–†–û–î–û–õ–ñ–ò–¢–¨</div>
            <div class="restart-btn" id="restartFromPauseBtn">–ó–ê–ù–û–í–û</div>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –ø–æ—Ä–∞–∂–µ–Ω–∏—è -->
        <div id="gameoverOverlay" class="overlay hidden">
            <div class="gameover-title">‚úß –©–ò–¢ –ü–ê–õ ‚úß</div>
            <div style="font-size: 32px; margin-bottom: 20px; color: #aaa;">–ö–û–†–ê–ë–õ–¨ –†–ê–ó–†–£–®–ï–ù</div>
            <div style="font-size: 26px; margin-bottom: 30px;" id="gameoverStats"></div>
            <div class="restart-btn" id="gameoverRestartBtn">–ó–ê–ü–£–°–¢–ò–¢–¨ –ó–ê–ù–û–í–û</div>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –ø–æ–±–µ–¥—ã -->
        <div id="victoryOverlay" class="overlay hidden">
            <div style="font-size: 70px; text-shadow: 0 0 40px cyan; margin-bottom: 20px; animation: pulse 2s infinite;">‚úß –ü–û–ë–ï–î–ê ‚úß</div>
            <div style="font-size: 36px; margin-bottom: 20px;">–ì–ê–õ–ê–ö–¢–ò–ö–ê –°–ü–ê–°–ï–ù–ê</div>
            <div style="font-size: 28px; margin-bottom: 30px;" id="victoryStats"></div>
            <div class="restart-btn" id="victoryRestartBtn">–ù–û–í–ê–Ø –ú–ò–°–°–ò–Ø</div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ----------------------------------------------------------------
            // 1. –¢–û–ß–ù–´–ô –°–ü–ò–°–û–ö ‚Äî 34 –°–õ–û–í–ê
            // ----------------------------------------------------------------
            const wordsData = [
                { full: "–ø–∞–ª–∏—Å–∞–¥–Ω–∏–∫", display: "–ø‚Ä¢–ª‚Ä¢—Å–∞–¥–Ω–∏–∫", missing: [1,3], letters: ["–ê","–ò"] },
                { full: "–ø–∞–ª–∏—Ç—Ä–∞", display: "–ø‚Ä¢–ª–∏—Ç—Ä–∞", missing: [1], letters: ["–ê"] },
                { full: "–ø–∞–Ω–æ—Ä–∞–º–∞", display: "–ø‚Ä¢–Ω‚Ä¢—Ä–∞–º–∞", missing: [1,3], letters: ["–ê","–û"] },
                { full: "–ø–∞–Ω–æ—Ä–∞–º–Ω—ã–π", display: "–ø‚Ä¢–Ω‚Ä¢—Ä–∞–º–Ω—ã–π", missing: [1,3], letters: ["–ê","–û"] },
                { full: "–ø–∞–Ω—Ü–∏—Ä—å", display: "–ø–∞–Ω—Ü‚Ä¢—Ä—å", missing: [4], letters: ["–ò"] },
                { full: "–ø–∞—Ä–∞–≥—Ä–∞—Ñ", display: "–ø‚Ä¢—Ä–∞–≥—Ä–∞—Ñ", missing: [1], letters: ["–ê"] },
                { full: "–ø–∞—Ä–∞–¥–æ–∫—Å", display: "–ø‚Ä¢—Ä‚Ä¢–¥–æ–∫—Å", missing: [1,3], letters: ["–ê","–ê"] },
                { full: "–ø–∞—Ä–∞–¥–æ–∫—Å–∞–ª—å–Ω—ã–π", display: "–ø‚Ä¢—Ä‚Ä¢–¥–æ–∫—Å–∞–ª—å–Ω—ã–π", missing: [1,3], letters: ["–ê","–ê"] },
                { full: "–ø–∞—Ä–∞—à—é—Ç", display: "–ø‚Ä¢—Ä–∞—à‚Ä¢—Ç", missing: [1,5], letters: ["–ê","–Æ"] },
                { full: "–ø–∞—Ç—Ä–∏–æ—Ç", display: "–ø‚Ä¢—Ç—Ä–∏–æ—Ç", missing: [1], letters: ["–ê"] },
                { full: "–ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º", display: "–ø‚Ä¢—Ç—Ä–∏–æ—Ç–∏–∑–º", missing: [1], letters: ["–ê"] },
                { full: "–ø–∞—Ç—Ä–∏–æ—Ç–∏—á–µ—Å–∫–∏–π", display: "–ø‚Ä¢—Ç—Ä–∏–æ—Ç–∏—á–µ—Å–∫–∏–π", missing: [1], letters: ["–ê"] },
                { full: "–ø–µ–π–∑–∞–∂", display: "–ø‚Ä¢–π–∑–∞–∂", missing: [1], letters: ["–ï"] },
                { full: "–ø–µ–π–∑–∞–∂–Ω—ã–π", display: "–ø‚Ä¢–π–∑–∞–∂–Ω—ã–π", missing: [1], letters: ["–ï"] },
                { full: "–ø–µ—Ä–∏–ª–∞", display: "–ø‚Ä¢—Ä–∏–ª–∞", missing: [1], letters: ["–ï"] },
                { full: "–ø–µ—Ä–∏–æ–¥", display: "–ø‚Ä¢—Ä–∏‚Ä¢–¥", missing: [1,4], letters: ["–ï","–û"] },
                { full: "–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π", display: "–ø‚Ä¢—Ä–∏‚Ä¢–¥–∏—á–µ—Å–∫–∏–π", missing: [1,4], letters: ["–ï","–û"] },
                { full: "–ø–µ—Å—Å–∏–º–∏—Å—Ç", display: "–ø‚Ä¢—Å—Å‚Ä¢–º–∏—Å—Ç", missing: [1,4], letters: ["–ï","–ò"] },
                { full: "–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π", display: "–ø‚Ä¢—Å—Å‚Ä¢–º–∏—Å—Ç–∏—á–Ω—ã–π", missing: [1,4], letters: ["–ï","–ò"] },
                { full: "–ø–µ—Å—Å–∏–º–∏–∑–º", display: "–ø‚Ä¢—Å—Å‚Ä¢–º–∏–∑–º", missing: [1,4], letters: ["–ï","–ò"] },
                { full: "–ø–æ–¥–ª–∏–Ω–Ω—ã–π", display: "–ø–æ–¥–ª‚Ä¢–Ω–Ω—ã–π", missing: [4], letters: ["–ò"] },
                { full: "–ø–æ–¥—Ä–∞–∂–∞—Ç—å", display: "–ø–æ–¥—Ä‚Ä¢–∂–∞—Ç—å", missing: [4], letters: ["–ê"] },
                { full: "–ø–æ–¥—Ä–∞–∂–∞–Ω–∏–µ", display: "–ø–æ–¥—Ä‚Ä¢–∂–∞–Ω–∏–µ", missing: [4], letters: ["–ê"] },
                { full: "–ø–æ–¥—Ä–∞–∂–∞—Ç–µ–ª—å", display: "–ø–æ–¥—Ä‚Ä¢–∂–∞—Ç–µ–ª—å", missing: [4], letters: ["–ê"] },
                { full: "–ø–æ–∑–∏—Ü–∏—è", display: "–ø‚Ä¢–∑–∏—Ü–∏—è", missing: [1], letters: ["–û"] },
                { full: "–ø–æ–∫–æ–π", display: "–ø‚Ä¢–∫–æ–π", missing: [1], letters: ["–û"] },
                { full: "–ø–æ–∫–æ–ª–µ–Ω–∏–µ", display: "–ø‚Ä¢–∫‚Ä¢–ª–µ–Ω–∏–µ", missing: [1,3], letters: ["–û","–û"] },
                { full: "–ø–æ–ª–µ–º–∏–∫–∞", display: "–ø‚Ä¢–ª–µ–º–∏–∫–∞", missing: [1], letters: ["–û"] },
                { full: "–ø–æ–ª–µ–º–∏—á–Ω—ã–π", display: "–ø‚Ä¢–ª–µ–º–∏—á–Ω—ã–π", missing: [1], letters: ["–û"] },
                { full: "–ø–æ–ª–∏—Ä–æ–≤–∞—Ç—å", display: "–ø‚Ä¢–ª‚Ä¢—Ä–æ–≤–∞—Ç—å", missing: [1,3], letters: ["–û","–ò"] },
                { full: "–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", display: "–ø‚Ä¢–ª‚Ä¢—Ä–æ–≤–∞–Ω–Ω—ã–π", missing: [1,3], letters: ["–û","–ò"] },
                { full: "–ø–æ—Ä–∞–∂–∞—Ç—å", display: "–ø‚Ä¢—Ä‚Ä¢–∂–∞—Ç—å", missing: [1,3], letters: ["–û","–ê"] },
                { full: "–ø–æ—Ä–∞–∂–µ–Ω–∏–µ", display: "–ø‚Ä¢—Ä‚Ä¢–∂–µ–Ω–∏–µ", missing: [1,3], letters: ["–û","–ê"] },
                { full: "–ø–æ—Ä–∞–∑–∏—Ç—å", display: "–ø‚Ä¢—Ä‚Ä¢–∑–∏—Ç—å", missing: [1,3], letters: ["–û","–ê"] },
                { full: "–ø–æ—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π", display: "–ø‚Ä¢—Ä‚Ä¢–∑–∏—Ç–µ–ª—å–Ω—ã–π", missing: [1,3], letters: ["–û","–ê"] },
                { full: "–ø–æ—Å–µ—â–∞—Ç—å", display: "–ø‚Ä¢—Å‚Ä¢—â–∞—Ç—å", missing: [1,3], letters: ["–û","–ï"] },
                { full: "–ø–æ—Å–µ—â–µ–Ω–∏–µ", display: "–ø‚Ä¢—Å‚Ä¢—â–µ–Ω–∏–µ", missing: [1,3], letters: ["–û","–ï"] },
                { full: "–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å", display: "–ø‚Ä¢—Å‚Ä¢—Ç–∏—Ç–µ–ª—å", missing: [1,3], letters: ["–û","–ï"] },
                { full: "–ø—Ä–∞–≤–∏–ª–æ", display: "–ø—Ä–∞–≤‚Ä¢–ª–æ", missing: [4], letters: ["–ò"] },
                { full: "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π", display: "–ø—Ä–∞–≤‚Ä¢–ª—å–Ω—ã–π", missing: [4], letters: ["–ò"] },
                { full: "–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π", display: "–ø—Ä–µ–¥–≤‚Ä¢—Ä–∏—Ç–µ–ª—å–Ω—ã–π", missing: [5], letters: ["–ê"] },
                { full: "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è", display: "–ø—Ä‚Ä¢–∑‚Ä¢–Ω—Ç–∞—Ü–∏—è", missing: [2,4], letters: ["–ï","–ï"] },
                { full: "–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç", display: "–ø—Ä‚Ä¢–∑–∏–¥–µ–Ω—Ç", missing: [2], letters: ["–ï"] },
                { full: "–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∏–π", display: "–ø—Ä‚Ä¢–∑–∏–¥–µ–Ω—Ç—Å–∫–∏–π", missing: [2], letters: ["–ï"] },
                { full: "–ø—Ä–µ–∑–∏–¥–∏—É–º", display: "–ø—Ä‚Ä¢–∑–∏–¥–∏—É–º", missing: [2], letters: ["–ï"] },
                { full: "–ø—Ä–µ–æ–±—Ä–∞–∑–∏—Ç—å", display: "–ø—Ä–µ–æ–±—Ä‚Ä¢–∑–∏—Ç—å", missing: [6], letters: ["–ê"] },
                { full: "–ø—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ", display: "–ø—Ä–µ–æ–±—Ä‚Ä¢–∂–µ–Ω–∏–µ", missing: [6], letters: ["–ê"] },
                { full: "–ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å", display: "–ø—Ä–µ–æ–¥‚Ä¢–ª–µ—Ç—å", missing: [5], letters: ["–û"] },
                { full: "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ", display: "–ø—Ä–µ–æ–¥‚Ä¢–ª–µ–Ω–∏–µ", missing: [5], letters: ["–û"] },
                { full: "–ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç", display: "–ø—Ä‚Ä¢—Ü‚Ä¢–¥–µ–Ω—Ç", missing: [2,4], letters: ["–ï","–ï"] },
                { full: "–ø—Ä–∏–≤–∏–ª–µ–≥–∏—è", display: "–ø—Ä‚Ä¢–≤‚Ä¢–ª–µ–≥–∏—è", missing: [2,5], letters: ["–ò","–ï"] },
                { full: "–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", display: "–ø—Ä‚Ä¢–≤‚Ä¢–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", missing: [2,5], letters: ["–ò","–ï"] },
                { full: "–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π", display: "–ø—Ä‚Ä¢–º‚Ä¢—Ç–∏–≤–Ω—ã–π", missing: [2,4], letters: ["–ò","–ò"] },
                { full: "–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç", display: "–ø—Ä‚Ä¢–æ—Ä‚Ä¢—Ç–µ—Ç", missing: [2,5], letters: ["–ò","–û"] },
                { full: "–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π", display: "–ø—Ä‚Ä¢–æ—Ä‚Ä¢—Ç–µ—Ç–Ω—ã–π", missing: [2,5], letters: ["–ò","–û"] },
                { full: "–ø—Ä–æ–≤–∏–Ω—Ü–∏—è", display: "–ø—Ä‚Ä¢–≤–∏–Ω—Ü–∏—è", missing: [2], letters: ["–û"] },
                { full: "–ø—Ä–æ–≤–∏–Ω—Ü–∏–∞–ª—å–Ω—ã–π", display: "–ø—Ä‚Ä¢–≤–∏–Ω—Ü–∏–∞–ª—å–Ω—ã–π", missing: [2], letters: ["–û"] },
                { full: "–ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞—Ç—å", display: "–ø—Ä–æ–≤‚Ä¢—Ü–∏—Ä–æ–≤–∞—Ç—å", missing: [4], letters: ["–û"] },
                { full: "–ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π", display: "–ø—Ä‚Ä¢–Ω‚Ä¢—Ü–∞—Ç–µ–ª—å–Ω—ã–π", missing: [2,4], letters: ["–û","–ò"] }
            ];

            // ----------------------------------------------------------------
            // 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
            // ----------------------------------------------------------------
            let words = wordsData.map((w, idx) => ({
                id: idx,
                full: w.full,
                display: w.display,
                missing: [...w.missing],
                letters: [...w.letters],
                learned: false
            }));

            let currentComet = null;
            let particles = [];
            let score = 0;
            let lives = 5;
            const MAX_LIVES = 7;
            let paused = false;
            let victory = false;
            let gameActive = true;
            let gameOver = false;
            let spawnTimer = 0;
            const SPAWN_DELAY = 45;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–º–µ—Ç—ã
            let rotationAngle = 0;

            // UI
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const msgEl = document.getElementById('messageEl');
            const scoreEl = document.getElementById('scoreDisplay');
            const livesContainer = document.getElementById('livesContainer');
            const progressFill = document.getElementById('progressFill');
            const learnedCounter = document.getElementById('learnedCounter');
            const learnedCountDetail = document.getElementById('learnedCountDetail');
            const wordGrid = document.getElementById('wordGrid');

            // –ö–∞—Ä—Ç–∏–Ω–∫–∏
            const cometImg = new Image();
            cometImg.src = 'comet.png';
            const cannonImg = new Image();
            cannonImg.src = 'cannon.png';

            // ----------------------------------------------------------------
            // 3. –†–ê–ó–ú–ï–† –ö–ê–ù–í–ê–°–ê
            // ----------------------------------------------------------------
            function resizeCanvas() {
                const container = document.querySelector('.canvas-wrap');
                const w = container.clientWidth;
                const h = container.clientHeight;
                canvas.width = w;
                canvas.height = h;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            // ----------------------------------------------------------------
            // 4. –ó–í–Å–ó–î–´ –ò –ê–°–¢–ï–†–û–ò–î–ù–´–ô –ü–û–Ø–°
            // ----------------------------------------------------------------
            function initSpaceObjects() {
                const spaceBg = document.getElementById('spaceBg');
                const asteroidBelt = document.getElementById('asteroidBelt');
                
                // –ó–≤—ë–∑–¥—ã
                for (let i = 0; i < 150; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.width = (Math.random() * 4 + 1) + 'px';
                    star.style.height = star.style.width;
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 5 + 's';
                    star.style.animationDuration = (Math.random() * 8 + 5) + 's';
                    spaceBg.appendChild(star);
                }
                
                // –ê—Å—Ç–µ—Ä–æ–∏–¥—ã
                for (let i = 0; i < 30; i++) {
                    const asteroid = document.createElement('div');
                    asteroid.className = 'mini-asteroid';
                    asteroid.style.width = (Math.random() * 25 + 10) + 'px';
                    asteroid.style.height = (Math.random() * 25 + 10) + 'px';
                    asteroid.style.left = Math.random() * 100 + '%';
                    asteroid.style.top = Math.random() * 100 + '%';
                    asteroid.style.animationDelay = Math.random() * 20 + 's';
                    asteroid.style.animationDuration = (Math.random() * 30 + 30) + 's';
                    asteroid.style.background = `rgba(${Math.random()*100+100}, ${Math.random()*100+100}, ${Math.random()*100+150}, 0.2)`;
                    asteroidBelt.appendChild(asteroid);
                }
            }
            initSpaceObjects();

            // ----------------------------------------------------------------
            // 5. –ü–†–û–í–ï–†–ö–ê –ö–ê–†–¢–ò–ù–û–ö
            // ----------------------------------------------------------------
            function checkImages() {
                const cannons = document.querySelectorAll('.cannon');
                
                cometImg.onerror = () => { console.log('comet.png –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç'); };
                
                cannonImg.onerror = () => {
                    console.log('cannon.png –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback');
                    cannons.forEach(c => c.classList.add('fallback'));
                };
            }
            checkImages();

            // ----------------------------------------------------------------
            // 6. UI
            // ----------------------------------------------------------------
            function updateLivesUI() {
                livesContainer.innerHTML = '';
                for (let i = 0; i < MAX_LIVES; i++) {
                    const life = document.createElement('div');
                    life.className = 'life' + (i < lives ? '' : ' dim');
                    livesContainer.appendChild(life);
                }
            }

            function setMessage(text, isGood = true) {
                msgEl.innerText = '‚ö° ' + text + ' ‚ö°';
                msgEl.style.color = isGood ? '#ffd966' : '#ff7b7b';
            }

            function updateLearnedCounter() {
                const learned = words.filter(w => w.learned).length;
                const total = words.length;
                learnedCounter.innerText = learned + '/' + total;
                learnedCountDetail.innerText = learned + ' / ' + total;
            }

            function updateDictionary() {
                const learned = words.filter(w => w.learned).length;
                const total = words.length;
                progressFill.style.width = total ? (learned / total * 100) + '%' : '0%';
                updateLearnedCounter();

                wordGrid.innerHTML = '';
                words.filter(w => w.learned).forEach(w => {
                    const chip = document.createElement('div');
                    chip.className = 'word-chip';
                    let html = '';
                    for (let i = 0; i < w.full.length; i++) {
                        if (w.missing.includes(i)) html += '<span>' + w.full[i] + '</span>';
                        else html += w.full[i];
                    }
                    chip.innerHTML = html;
                    wordGrid.appendChild(chip);
                });

                if (learned === total && total > 0 && !victory && gameActive) {
                    victory = true;
                    document.getElementById('victoryOverlay').classList.remove('hidden');
                    document.getElementById('victoryStats').innerHTML = `–°–ø–∞—Å–µ–Ω–æ —Å–ª–æ–≤: ${score/100}<br>–ò–∑—É—á–µ–Ω–æ: ${learned}/${total}`;
                }
            }

            // ----------------------------------------------------------------
            // 7. –í–ó–†–´–í
            // ----------------------------------------------------------------
            function createExplosion(x, y) {
                for (let i = 0; i < 35; i++) {
                    particles.push({
                        x, y,
                        vx: (Math.random() - 0.5) * 12,
                        vy: (Math.random() - 0.5) * 12 - 4,
                        life: 40 + Math.floor(Math.random() * 50),
                        color: `hsl(${Math.random() * 60 + 180}, 100%, 65%)`
                    });
                }
            }

            // ----------------------------------------------------------------
            // 8. –í–´–°–¢–†–ï–õ
            // ----------------------------------------------------------------
            function fireCannon(letter) {
                const cannons = document.querySelectorAll('.cannon');
                cannons.forEach(c => {
                    if (c.dataset.letter === letter) {
                        c.classList.add('fire');
                        setTimeout(() => c.classList.remove('fire'), 160);
                    }
                });
            }

            // ----------------------------------------------------------------
            // 9. –°–ü–ê–í–ù –ö–û–ú–ï–¢–´
            // ----------------------------------------------------------------
            function spawnComet() {
                if (paused || victory || !gameActive || gameOver) return;
                if (currentComet !== null) return;
                
                const available = words.filter(w => !w.learned);
                if (available.length === 0) return;

                const word = available[Math.floor(Math.random() * available.length)];
                
                const x = canvas.width / 2;
                const y = -80;

                currentComet = {
                    id: Date.now() + Math.random(),
                    wordId: word.id,
                    display: word.display,
                    currentDisplay: word.display,
                    missing: [...word.missing],
                    letters: [...word.letters],
                    step: 0,
                    x, y,
                    speed: 0.75,
                    width: 220,
                    height: 90
                };
            }

            // ----------------------------------------------------------------
            // 10. –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–ï
            // ----------------------------------------------------------------
            function destroyComet() {
                if (!currentComet) return;

                const word = words.find(w => w.id === currentComet.wordId);
                if (word && !word.learned) {
                    word.learned = true;
                }

                score += 100;
                scoreEl.innerText = score;

                if (score % 450 < 50 && lives < MAX_LIVES) {
                    lives++;
                    updateLivesUI();
                    setMessage('+1 –©–ò–¢', true);
                }

                createExplosion(currentComet.x, currentComet.y);
                currentComet = null;
                updateDictionary();
            }

            // ----------------------------------------------------------------
            // 11. –ë–£–ö–í–ê
            // ----------------------------------------------------------------
            function handleLetter(letter) {
                if (paused || victory || !gameActive || gameOver) return;
                fireCannon(letter);

                if (!currentComet) {
                    setMessage('–ù–ï–¢ –¶–ï–õ–ò', false);
                    return;
                }

                const comet = currentComet;
                
                if (comet.step >= comet.letters.length) {
                    destroyComet();
                    setMessage('–ö–û–ú–ï–¢–ê –£–ù–ò–ß–¢–û–ñ–ï–ù–ê', true);
                    return;
                }

                const expected = comet.letters[comet.step];

                if (letter === expected) {
                    const idx = comet.missing[comet.step];
                    let arr = comet.currentDisplay.split('');
                    arr[idx] = letter;
                    comet.currentDisplay = arr.join('');
                    comet.step++;

                    setMessage('–ü–û–ü–ê–î–ê–ù–ò–ï!', true);

                    if (comet.step === comet.letters.length) {
                        destroyComet();
                        setMessage('–ö–û–ú–ï–¢–ê –†–ê–ó–†–£–®–ï–ù–ê', true);
                    }
                } else {
                    setMessage('–û–®–ò–ë–ö–ê', false);
                    lives--;
                    updateLivesUI();
                    
                    comet.step = 0;
                    comet.currentDisplay = comet.display;

                    if (lives <= 0) {
                        gameActive = false;
                        gameOver = true;
                        setMessage('–ö–û–†–ê–ë–õ–¨ –†–ê–ó–†–£–®–ï–ù', false);
                        document.getElementById('gameoverOverlay').classList.remove('hidden');
                        document.getElementById('gameoverStats').innerHTML = `–£–Ω–∏—á—Ç–æ–∂–µ–Ω–æ —Å–ª–æ–≤: ${score/100}<br>–ò–∑—É—á–µ–Ω–æ: ${words.filter(w => w.learned).length}/${words.length}`;
                    }
                }
            }

            // ----------------------------------------------------------------
            // 12. –î–í–ò–ñ–ï–ù–ò–ï
            // ----------------------------------------------------------------
            function move() {
                if (paused || victory) return;

                if (currentComet) {
                    currentComet.y += currentComet.speed;
                    
                    if (currentComet.y > canvas.height + 80) {
                        currentComet = null;
                        lives--;
                        updateLivesUI();
                        setMessage('–ü–†–û–ë–û–ò–ù–ê', false);
                        
                        if (lives <= 0) {
                            gameActive = false;
                            gameOver = true;
                            setMessage('–ö–û–†–ê–ë–õ–¨ –†–ê–ó–†–£–®–ï–ù', false);
                            document.getElementById('gameoverOverlay').classList.remove('hidden');
                            document.getElementById('gameoverStats').innerHTML = `–£–Ω–∏—á—Ç–æ–∂–µ–Ω–æ —Å–ª–æ–≤: ${score/100}<br>–ò–∑—É—á–µ–Ω–æ: ${words.filter(w => w.learned).length}/${words.length}`;
                        }
                    }
                }

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1;
                    p.life--;
                    if (p.life <= 0 || p.y > canvas.height + 50) {
                        particles.splice(i, 1);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è
                rotationAngle = (rotationAngle + 2) % 360;
            }

            // ----------------------------------------------------------------
            // 13. –û–¢–†–ò–°–û–í–ö–ê –° –í–†–ê–©–ï–ù–ò–ï–ú –ö–û–ú–ï–¢–´
            // ----------------------------------------------------------------
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // –ö–û–ú–ï–¢–ê —Å –≤—Ä–∞—â–µ–Ω–∏–µ–º
                if (currentComet) {
                    const c = currentComet;
                    
                    ctx.save();
                    ctx.translate(c.x, c.y);
                    
                    // –í—Ä–∞—â–∞–µ–º –∫–æ–º–µ—Ç—É (—Å–ª–æ–≤–∞ –Ω–µ –≤—Ä–∞—â–∞—é—Ç—Å—è!)
                    ctx.rotate(rotationAngle * Math.PI / 180);
                    
                    // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∫–æ–º–µ—Ç—ã
                    if (cometImg.complete && cometImg.naturalHeight > 0) {
                        ctx.drawImage(cometImg, -110, -45, 220, 90);
                    } else {
                        // fallback ‚Äî —Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–π –∞—Å—Ç–µ—Ä–æ–∏–¥
                        ctx.shadowColor = '#0ff';
                        ctx.shadowBlur = 35;
                        ctx.fillStyle = '#2a1e4a';
                        ctx.strokeStyle = '#0ff';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        for (let i = 0; i < 6; i++) {
                            const angle = i * 60 * Math.PI / 180;
                            const px = 110 * Math.cos(angle);
                            const py = 45 * Math.sin(angle);
                            if (i === 0) ctx.moveTo(px, py);
                            else ctx.lineTo(px, py);
                        }
                        ctx.closePath();
                        ctx.fill();
                        ctx.stroke();
                    }
                    ctx.restore();

                    // –¢–µ–∫—Å—Ç –ü–û–í–ï–†–• ‚Äî –ë–ï–ó –í–†–ê–©–ï–ù–ò–Ø!
                    ctx.font = 'bold 26px "Courier New", monospace';
                    ctx.fillStyle = '#ffffff';
                    ctx.shadowColor = '#0ff';
                    ctx.shadowBlur = 15;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(c.currentDisplay, c.x, c.y);
                    ctx.shadowBlur = 0;
                }

                // –ß–∞—Å—Ç–∏—Ü—ã –≤–∑—Ä—ã–≤–∞
                particles.forEach(p => {
                    ctx.globalAlpha = p.life / 60;
                    ctx.fillStyle = p.color;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = p.color;
                    ctx.fillRect(p.x, p.y, 7, 7);
                });
                ctx.globalAlpha = 1;
                ctx.shadowBlur = 0;
            }

            // ----------------------------------------------------------------
            // 14. –ò–ì–†–û–í–û–ô –¶–ò–ö–õ
            // ----------------------------------------------------------------
            function gameLoop() {
                if (!paused && !victory && gameActive && !gameOver) {
                    spawnTimer++;
                    if (spawnTimer >= SPAWN_DELAY && currentComet === null) {
                        spawnComet();
                        spawnTimer = 0;
                    }
                    move();
                }
                draw();
                requestAnimationFrame(gameLoop);
            }

            // ----------------------------------------------------------------
            // 15. –†–ï–°–¢–ê–†–¢
            // ----------------------------------------------------------------
            function restartGame() {
                words = wordsData.map((w, idx) => ({
                    id: idx,
                    full: w.full,
                    display: w.display,
                    missing: [...w.missing],
                    letters: [...w.letters],
                    learned: false
                }));

                currentComet = null;
                particles = [];
                score = 0;
                lives = 5;
                paused = false;
                victory = false;
                gameActive = true;
                gameOver = false;
                spawnTimer = 0;
                rotationAngle = 0;

                scoreEl.innerText = '0';
                updateLivesUI();
                updateDictionary();
                setMessage('–ù–û–í–ê–Ø –ú–ò–°–°–ò–Ø', true);
                
                document.getElementById('pauseOverlay').classList.add('hidden');
                document.getElementById('victoryOverlay').classList.add('hidden');
                document.getElementById('gameoverOverlay').classList.add('hidden');
            }

            // ----------------------------------------------------------------
            // 16. –°–û–ë–´–¢–ò–Ø
            // ----------------------------------------------------------------
            function initEvents() {
                document.querySelectorAll('.cannon').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const letter = e.currentTarget.dataset.letter;
                        handleLetter(letter);
                    });
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        const letter = e.currentTarget.dataset.letter;
                        handleLetter(letter);
                    });
                });

                document.getElementById('pauseBtn').addEventListener('click', () => {
                    if (victory || gameOver) return;
                    paused = !paused;
                    document.getElementById('pauseOverlay').classList.toggle('hidden', !paused);
                    if (!paused) setMessage('–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï', true);
                });

                document.getElementById('restartFromPauseBtn').addEventListener('click', () => {
                    restartGame();
                    paused = false;
                    document.getElementById('pauseOverlay').classList.add('hidden');
                });
                document.getElementById('resumeBtn').addEventListener('click', () => {
                    paused = false;
                    document.getElementById('pauseOverlay').classList.add('hidden');
                    setMessage('–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï', true);
                });
                document.getElementById('victoryRestartBtn').addEventListener('click', restartGame);
                document.getElementById('gameoverRestartBtn').addEventListener('click', restartGame);
            }

            // ----------------------------------------------------------------
            // 17. –°–¢–ê–†–¢
            // ----------------------------------------------------------------
            function init() {
                updateLivesUI();
                updateDictionary();
                initEvents();
                gameLoop();
            }

            init();
        })();
    </script>
</body>
</html>